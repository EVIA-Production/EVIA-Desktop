<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVIA Audio Diagnostics</title>
    <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f7;
      color: #333;
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    button {
      background-color: #0071e3;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #0077ed;
    }
    button:active {
      background-color: #0068d1;
    }
    button.secondary {
      background-color: #6c757d;
    }
    button.danger {
      background-color: #dc3545;
    }
    button.success {
      background-color: #28a745;
    }
    .status {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .status.active {
      background-color: #28a745;
    }
    .status.inactive {
      background-color: #dc3545;
    }
    .status-text {
      font-weight: 500;
    }
    .logs {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-bottom: 10px;
    }
    .tabs {
      display: flex;
      margin-bottom: 10px;
      border-bottom: 1px solid #dee2e6;
    }
    .tab {
      padding: 8px 16px;
      cursor: pointer;
      background-color: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      margin-right: 5px;
    }
    .tab.active {
      border-bottom-color: #0071e3;
      font-weight: 500;
      color: #0071e3;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    canvas {
      width: 100%;
      max-width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table td {
      padding: 6px;
      border-bottom: 1px solid #eee;
    }
    table td:first-child {
      font-weight: 500;
      width: 40%;
    }
    .issue {
      color: #dc3545;
    }
    #systemStatus, #micStatus {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .status-good {
      background-color: rgba(40, 167, 69, 0.1);
      border: 1px solid rgba(40, 167, 69, 0.3);
    }
    .status-warning {
      background-color: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
    }
    .status-error {
      background-color: rgba(220, 53, 69, 0.1);
      border: 1px solid rgba(220, 53, 69, 0.3);
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
      <h1>EVIA Audio Diagnostics</h1>
      <p>This tool helps diagnose issues with audio capture and processing for EVIA Desktop.</p>
      
      <div class="buttons">
        <button id="startMic">Start Mic Capture</button>
        <button id="startSystem">Start System Audio</button>
        <button id="stopCapture">Stop Capture</button>
        <button id="exportMicWav" class="secondary">Export Mic WAV</button>
        <button id="exportSystemWav" class="secondary">Export System WAV</button>
        <button id="runDiagnostics" class="success">Run Full Diagnostics</button>
        <button id="testTone" class="secondary">Play Test Tone</button>
        <button id="launchMain" class="secondary">Launch Main App</button>
      </div>
      
      <div class="tabs">
        <button class="tab active" data-tab="visualizer">Live Visualizer</button>
        <button class="tab" data-tab="metrics">Audio Metrics</button>
        <button class="tab" data-tab="logs">Logs</button>
        <button class="tab" data-tab="diagnostics">Diagnostics</button>
        <button class="tab" data-tab="spectrograms">Spectrograms</button>
        </div>

      <div id="visualizer" class="tab-content active">
        <h2>Audio Visualizer</h2>
        <div class="grid">
          <div>
            <h3>Microphone</h3>
            <div id="micStatus"></div>
            <div id="micVisualizerContainer"></div>
          </div>
          <div>
            <h3>System Audio</h3>
            <div id="systemStatus"></div>
            <div id="systemVisualizerContainer"></div>
          </div>
        </div>
        </div>

      <div id="metrics" class="tab-content">
        <h2>Audio Metrics</h2>
        <div class="grid">
          <div>
            <h3>Microphone</h3>
            <table id="micMetricsTable">
              <tr><td>Sample Rate</td><td id="micSampleRate">-</td></tr>
              <tr><td>RMS Level</td><td id="micRmsLevel">-</td></tr>
              <tr><td>Buffer Size</td><td id="micBufferSize">-</td></tr>
              <tr><td>WebSocket Status</td><td id="micWsStatus">Disconnected</td></tr>
              <tr><td>Deepgram Status</td><td id="micDgStatus">Closed</td></tr>
            </table>
          </div>
            <div>
            <h3>System Audio</h3>
            <table id="systemMetricsTable">
              <tr><td>Sample Rate</td><td id="systemSampleRate">-</td></tr>
              <tr><td>RMS Level</td><td id="systemRmsLevel">-</td></tr>
              <tr><td>Buffer Size</td><td id="systemBufferSize">-</td></tr>
              <tr><td>WebSocket Status</td><td id="systemWsStatus">Disconnected</td></tr>
              <tr><td>Deepgram Status</td><td id="systemDgStatus">Closed</td></tr>
            </table>
            </div>
        </div>
    </div>

      <div id="logs" class="tab-content">
        <h2>Debug Logs</h2>
        <div class="logs" id="logOutput"></div>
        <button id="clearLogs" class="secondary">Clear Logs</button>
        <button id="exportLogs" class="secondary">Export Logs</button>
      </div>
      
      <div id="diagnostics" class="tab-content">
        <h2>System Diagnostics</h2>
        <div id="diagnosticsOutput">
          <p>Click "Run Full Diagnostics" to analyze the audio system.</p>
        </div>
      </div>
      
      <div id="spectrograms" class="tab-content">
        <h2>Audio Spectrograms</h2>
        <div class="grid">
          <div>
            <h3>Microphone</h3>
            <div id="micSpectrogramContainer"></div>
          </div>
          <div>
            <h3>System Audio</h3>
            <div id="systemSpectrogramContainer"></div>
          </div>
        </div>
        <button id="generateSpectrograms" class="secondary">Generate Spectrograms</button>
      </div>
    </div>
    
    <div class="card">
      <h2>Permissions</h2>
      <p>This tool requires microphone and system audio capture permissions.</p>
      <div class="buttons">
        <button id="requestMicPermission">Request Mic Permission</button>
        <button id="openSystemPrefs">Open System Preferences</button>
      </div>
    </div>
  </div>
  
  <script type="module" src="./audio-debug.js"></script>
</body>
</html>